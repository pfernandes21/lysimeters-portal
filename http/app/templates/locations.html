{% extends "base.html" %}

{% block content %}
<form action="{{ url_for('create_location') }}" method="get">
    <button type="submit" class="btn btn-default">
        Add Location <span class="glyphicon glyphicon-plus"></span>
    </button>
</form>

<table class="table table-striped table-bordered table-sm" cellspacing="0" width="100%">
    <thead>
        <tr>
            <th class="th-sm">Name</th>

            <th class="th-sm">Latitude</th>

            <th class="th-sm">Longitude</th>

            <th class="th-sm">Created At</th>

            <th class="th-sm">Updated At</th>

            <th class="th-sm">Status</th>

        </tr>
    </thead>
    <tbody>
        {% for location in locations %}
        <tr>
            <td>{{ location.name }}</td>
            <td>{{ location.latitude }}</td>
            <td>{{ location.longitude }}</td>
            <td>{{ location.created_at }}</td>
            <td>{{ location.updated_at }}</td>
            <td>{{ location.status }}</td>
            <td style="display: flex; justify-content: space-evenly;">
                <form action="/location/{{ location.id }}/machines" method="get">
                    <button type="submit">Machines</button>
                </form>
                <form action="/location/{{ location.id }}/delete" method="post">
                    <input type="hidden" name="csrf_token" value="{{ csrf_token() }}" />
                    <button type="submit">Delete</button>
                </form>
            </td>
        </tr>
        {% endfor %}
    </tbody>
    <!-- <tfoot>
      <tr>
        <th>Name
        </th>
        <th>Position
        </th>
        <th>Office
        </th>
        <th>Age
        </th>
        <th>Start date
        </th>
        <th>Salary
        </th>
      </tr>
    </tfoot> -->
</table>

<div id="map" style="width: 100%; height: 400px;"></div>

<script>
    var map;
    var markers = [];

    function initMap() {
        var portugal = new google.maps.LatLng(39.693519, -7.996114);
        map = new google.maps.Map(
            document.getElementById('map'), { center: portugal, zoom: 6 });
        
        {% for location in locations %}
        markers.push(new google.maps.Marker({
            position: new google.maps.LatLng({{ location.latitude }}, {{ location.longitude }}),
            map: map
        }));
        {% endfor %}
    }
</script>

<!-- Async script executes immediately and must be after any DOM elements used in callback. -->
<script async
    src="https://maps.googleapis.com/maps/api/js?key=AIzaSyAQfMvz5_Stvt3Mmun0iOGu9GQFjgFjEJ0&libraries=places&callback=initMap">
    </script>

{% endblock %}